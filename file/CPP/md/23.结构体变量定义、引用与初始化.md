# 结构体变量定义、引用与初始化

​	在C语言中，结构体（Structures）是由多个不同类型的数据项组成的复合数据类型。结构体在组织和处理数据方面非常有用，尤其是当数据项可以逻辑上组合在一起时。结构体是C语言中极其有用的数据结构，用于将逻辑上相关的数据组合成单个单元，以简化程序的数据管理和提高代码清晰度。

## 1.结构体简介

​	结构体是一种允许将不同类型的数据项（称为成员）组合成一个单一实体的复合数据类型。它广泛用于程序中数据的组织和管理，因为它可以模拟现实生活中的数据对象。例如，一个学生结构体可以包含学生的姓名、性别、年龄等信息。

​	结构体通过 `struct` 关键字定义，其后是结构体的名称和一系列在大括号内声明的成员变量。每个成员可以是不同的数据类型，包括其他结构体或指针。结构体可以像普通变量一样声明，也可以使用指针来动态分配。

例如，表示学生信息的结构体可能如下所示：

```c
struct Student {
    int id;
    char name[100];
    float grade;
    char department[50];
};
```

​	结构体可以在声明时直接初始化，或者可以在之后的任何时候赋值。结构体成员可以通过点操作符（`.`）访问，如果是指向结构体的指针，则使用箭头操作符（`->`）。结构体使得处理复杂数据、传递函数参数等操作更加高效和清晰。

## 2.定义结构体类型变量的方法

在C语言中，可以通过几个步骤来定义一个结构体并声明它的变量：

1. 使用 `struct` 关键字定义结构体类型，然后列出所有成员（成员变量）。
2. 成员变量可以是任何数据类型，包括其它结构体或者指向数据的指针。
3. 一旦结构体类型被定义，就可以声明该类型的变量。

​	定义结构体变量的一般形式：`struct 结构体名 变量名列表;`

### 使用结构体变量的三种主要方法

#### (1) 直接声明结构体变量

在定义结构体时，可以直接在结构体定义的末尾声明变量。

```c
struct student {
    int num;         // 学号
    char name[100];  // 姓名
    int sex;         // 性别
    int age;         // 年龄
    char address[100]; // 地址
} s1, s2; // 直接声明了两个student类型的结构体变量s1和s2
```

#### (2) 定义结构体类型后分别声明变量

也可以先定义结构体类型，稍后声明该类型的变量。

```c
struct student {
    int num;
    char name[100];
    int sex;
    int age;
    char address[100];
};

struct student s1, s2; // 定义了student类型之后，分别声明了s1和s2两个变量
```

#### (3) 通过typedef创建新类型

使用 `typedef` 关键字可以创建新的类型名称，使得在声明结构体变量时不需要使用 `struct` 关键字。

```c
typedef struct {
    int month;
    int day;
    int year;
} Date;

typedef struct {
    int num;
    char name[100];
    int sex;
    int age;
    char address[100];
    Date birthday;  // 使用了新定义的Date类型
} Student;

Student s1, s2; // 通过typedef定义的Student新类型来声明s1和s2
```

​	在这个示例中，`Date` 和 `Student` 成为了新的类型名称，可以在后续的代码中像使用其他任何数据类型一样使用它们。

​	通过这些方法，C语言提供了强大的结构体变量定义和使用机制，它们允许程序员以清晰和结构化的方式表示复杂的数据。

#### (4) 通过typedef创建新类型

​	特殊的连结构体名可以省略情况下的定义结构体类型变量，一般形式如下：

```c
struct
{
    成员列表;
} 变量名列表;
```



### 示例

定义一个名为 `student` 的结构体类型，并声明了两个结构体变量 `s1` 和 `s2`：

```c
struct student
{
    int num;           // 学号
    char name[100];    // 姓名
    int sex;           // 性别：0表示女性，1表示男性
    int age;           // 年龄
    char address[100]; // 地址
} s1, s2;
```

​	这个结构体 `student` 包含了学生的基本信息，如学号、姓名、性别、年龄和地址。其中 `sex` 字段可能用数字来表示性别，例如，`0` 可能代表女性，`1` 代表男性。

另一个示例展示了如何在一个结构体内嵌套另一个结构体：

```c
struct date
{
    int month; // 月份
    int day;   // 日期
    int year;  // 年份
};

struct student
{
    int num;             // 学号
    char name[100];      // 姓名
    int sex;             // 性别
    int age;             // 年龄
    char address[100];   // 地址
    struct date birthday; // 生日
};
```

​	在这里，`student` 结构体包含了一个 `date` 类型的 `birthday` 成员，它本身也是一个结构体，包含了月、日和年三个成员变量。

​	结构体内成员（成员变量）名可以与程序中的变量名相同，例如定义一个名字叫作num的普通变量，和结构体中定义的int num；不冲突。

​	总结来说，定义结构体类型变量的方法包括定义结构体类型，并提供成员列表。结构体成员可以是基本数据类型或其他结构体，甚至可以是指针。定义后，可以直接声明结构体类型的变量，或者通过在声明时添加变量名的方式来直接创建结构体变量。嵌套结构体使得定义复杂的数据结构变得简单，使得数据的组织更加有结构性和直观。

## 3.结构体类型变量的引用

​	在C语言中引用结构体类型的变量，也就是如何访问和修改结构体中的成员数据。如下：

要引用结构体类型变量的成员，可以使用以下方法：

1. **直接访问成员**：如果有一个结构体类型的变量，可以使用点（`.`）操作符直接访问它的成员。
2. **通过指针访问成员**：如果有一个指向结构体的指针，可以使用箭头（`->`）操作符来访问它的成员。

**示例**

假设有如下结构体定义和变量声明：

```c
struct student {
    int num;
    char name[100];
    int age;
    char address[100];
    struct date {
        int month;
        int day;
        int year;
    } birthday;
} s1, s2;
```

下面是如何引用结构体变量 `s1` 和 `s2` 的成员的例子：

1. **直接访问结构体成员**：

```c
s1.num = 1001;  // 直接给结构体s1的成员num赋值为1001
printf("Student number: %d\n", s1.num);  // 打印结构体s1的成员num
```

2. **访问嵌套结构体成员**：

```c
s1.birthday.month = 12;  // 给嵌套结构体s1的birthday成员的month赋值为12
s1.birthday.day = 30;    // 给嵌套结构体s1的birthday成员的day赋值为30
s1.birthday.year = 2018; // 给嵌套结构体s1的birthday成员的year赋值为2018
```

3. **通过指针访问结构体成员**：

```c
struct student *ptr = &s1;
ptr->age = 20;  // 通过指向结构体s1的指针ptr来修改s1的成员age为20
printf("Student age: %d\n", ptr->age);  // 通过指针ptr打印结构体s1的成员age
```

4. **通过结构体指针变量间接访问和复制结构体变量**：

```c
s2.age = s1.age;  // 直接复制结构体s1的age成员到结构体s2的age
```

通过这些示例，我们看到引用结构体变量的成员是非常直接的，无论是通过变量本身还是通过指向该变量的指针。这使得在函数间传递复杂的数据结构和对其进行操作变得更简单。



### 额外拓展：

关于结构体变量在C语言中如何被引用和操作的一些关键点：

1. **结构体变量的整体引用**： 在C语言中，不能将整个结构体变量作为一个单一实体进行操作（例如不能整体赋值或者整体比较），只能对它的单独成员进行操作。
2. **结构体嵌套成员的访问**： 如果一个结构体的成员本身是另一个结构体类型，那么访问这个成员的子成员时，需要逐层使用点（`.`）或箭头（`->`）操作符来访问。
3. **结构体成员变量的地址**： 结构体中的每个成员变量都有自己的地址，可以像操作普通变量那样使用指针来访问或修改成员变量。

例如，如果有如下结构体定义：

```c
struct Date {
    int month;
    int day;
    int year;
};

struct Student {
    int id;
    char name[100];
    struct Date birthday;
};
```

和以下结构体变量：

```
struct Student student;
```

我们可以按如下方式操作成员：

- **访问成员变量**：`student.id` 或 `student.name`
- **访问嵌套成员变量**：`student.birthday.month`，`student.birthday.day`，`student.birthday.year`
- **获取成员变量的地址**：`&student.id` 或 `&student.name`
- **对结构体变量的成员赋值**：`student.id = 100;`
- **不能对结构体的嵌套结构体成员整体赋值**：不能直接 `student.birthday = {1, 1, 2020};` 必须逐个成员赋值

​	这些点阐明了结构体的用法和某些限制，特别是涉及到结构体成员的赋值和访问时。在C语言中处理结构体数据时，需要遵循这些规则，以确保程序的正确性和预期行为。

​	在C语言中，您可以将一个结构体变量赋值给另一个结构体变量，前提是它们都是相同类型的结构体。所以，假设您已经有一个类型为 `struct Student` 的已经初始化的结构体变量 `student2`，那么您可以将 `student2` 赋值给另一个同类型的新变量 `student1`。这样的赋值会复制 `student2` 的每个成员的值到 `student1` 对应的成员中。

```c
struct Student student2;
student2.id = 100;
// 假设student2的其他成员已经被赋值

struct Student student1 = student2;  // 正确，这会复制student2的所有成员到student1
```

在这个赋值操作之后，`student1` 的所有成员变量将拥有与 `student2` 相同的值。这是结构体在C语言中的一个特性，它允许整体赋值，因为结构体是值类型。这种赋值是成员到成员的浅拷贝，如果结构体中有指针成员，只会复制指针的值（地址），而不会复制指针指向的数据。

## 4. 结构体变量的初始化

在C语言中，可以在声明结构体变量时直接进行初始化。初始化的格式是在声明结构体变量的同时，在花括号中按照结构体成员定义的顺序提供初始值。如果你不初始化，结构体成员将包含不确定的值（通常是垃圾值）。

**示例**

假设有一个结构体 `student` 用来存储学生的信息，包括学号、姓名、性别、年龄和生日。生日是另一个结构体类型 `date` 的成员，存储月、日和年。一个名为 `s5` 的结构体变量可以如下初始化：

```c
struct student s5 = {100, "王五", 1, 16, {3, "九月", 10, 14, 2018}};
```

在这个示例中，`s5` 的 `num` 成员被初始化为 `100`，`name` 成员为 `"王五"`，`sex` 成员为 `1`（可能表示男性），`age` 成员为 `16`，`birthday` 结构体成员按月、日、年的顺序初始化为 `3`、`"九月"`、`10`、`14`、`2018`。

**结构体变量成员的引用**

要引用结构体的成员变量，可以使用点操作符（`.`）。如果有一个指向结构体变量的指针，可以使用箭头操作符（`->`）来引用其成员变量。

继续使用上面的 `student` 结构体变量 `s5` 的示例，以下代码展示了如何引用和打印 `s5` 的 `num` 成员：

```c
s1.num = 1001; // 直接为s1的成员num赋值
int* p = &s1.num; // 获取s1的成员num的地址
printf("%d\n", *p); // 打印num成员的值
```

在上面的代码中，首先将 `s1` 结构体的 `num` 成员设置为 `1001`。然后，通过取地址符（`&`）获取 `num` 成员的地址并将其赋值给整型指针 `p`。最后，使用解引用操作符（`*`）来打印 `p` 指向的值，即 `num` 成员的值。

### 拓展：

​	在C语言中，不能在声明结构体变量之后在一个单独的语句中使用花括号初始化器。初始化器只能在声明结构体变量的同时使用。因此，下面的代码是不合法的：

```c
struct student s5;
s5 = {100, "王五", 1, 16, {3, "九月", 10, 14, 2018}}; // 错误！

// 或者：
#include <stdio.h>
struct Person {
    char name[50];
    int age;
};

int main() {
    struct Person person = {"Alice", 30};
    printf("person = %s\n", person); // 错误：不能直接打印结构体
    return 0;
}
```

这将导致一个编译错误，因为花括号初始化器只能用于定义时的直接初始化。

但是，您可以单独为结构体的每个成员赋值：

```c
struct student s5;
s5.num = 100;
strcpy(s5.name, "王五");
s5.sex = 1;
s5.age = 16;
s5.birthday.month = 3;
strcpy(s5.birthday.monthName, "九月");
s5.birthday.day = 10;
s5.birthday.year = 2018;
```

在C99标准及以后，还可以使用指定的初始化器为结构体赋值，例如：

```c
struct student s5 = {
    .num = 100,
    .name = "王五",
    .sex = 1,
    .age = 16,
    .birthday = {.month = 3, .monthName = "九月", .day = 10, .year = 2018}
};
```

这种方式也只适用于声明时，而不适用于之后的赋值。在声明后，您必须单独对每个成员变量进行赋值。
