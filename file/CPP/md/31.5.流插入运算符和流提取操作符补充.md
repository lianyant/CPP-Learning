# <<(流插入运算符)和>>(流提取操作符)补充

## 1.<<(流插入运算符)

在 C++ 中，`<<` 被称为流插入运算符（stream insertion operator），它是用于向输出流中插入数据的运算符。流插入运算符可以被重载，以便用于自定义类型以及标准库中的类型，如 `std::ostream`。它使得向标凈输出流（如 `std::cout`）、文件流（如 `std::ofstream`）、或其他类型的输出流（如 `std::stringstream`）发送数据变得简洁方便。

### 原理

流插入运算符通过重载 `operator<<` 函数实现，这允许开发者定义自定义类型如何被输出到流中。当你使用 `std::cout << "Hello";` 这样的语句时，你实际上是调用了 `std::ostream` 的 `operator<<` 成员函数或友元函数，将字符串 `"Hello"` 插入到 `std::cout` 流中。

### 函数原型

对于基本类型（如整型、浮点型、字符型等），C++ 标准库已经为 `std::ostream` 提供了多个重载版本的 `operator<<`。这些函数通常被定义为 `std::ostream` 类的成员函数或友元函数。下面是一些常见的流插入运算符的函数原型示例：

```cpp
std::ostream& operator<<(std::ostream& os, const char* s);
std::ostream& operator<<(std::ostream& os, const std::string& s);
std::ostream& operator<<(std::ostream& os, int n);
std::ostream& operator<<(std::ostream& os, double d);
```

这些函数通常接受一个引用到 `std::ostream` 对象和要插入的数据。函数返回对 `std::ostream` 对象的引用，这允许链式调用，即可以连续使用多个 `<<` 运算符。

### `<<` 运算符重载通常看起来像这样

```cpp
ostream& operator<<(ostream& os, const T& value) {
    // 实现将 value 输出到流 os 中的逻辑
    return os;
}
```

​	这里的 `T` 可以是任何类型，如 `int`、`double`、`std::string` 或者用户定义的类型。为了使得 `std::cout << value` 能够工作，必须有一个接受 `value` 类型的 `<<` 运算符重载。

### 示例：重载自定义类型

如果你有一个自定义类型，比如一个 `Person` 类，并希望能够通过 `std::cout` 直接输出，你可以重载 `operator<<` 以实现这一功能：

```cpp
#include <iostream>
#include <string>

class Person {
public:
    std::string name;
    int age;

    Person(const std::string& n, int a) : name(n), age(a) {}
};

// 重载 operator<< 为 Person 类
std::ostream& operator<<(std::ostream& os, const Person& p) {
    os << "Name: " << p.name << ", Age: " << p.age;
    return os;
}

int main() {
    Person john("John Doe", 30);
    std::cout << john << std::endl;
    return 0;
}
```

在这个例子中，我们定义了一个 `Person` 类，并重载了 `operator<<` 来允许 `Person` 对象可以通过 `std::cout` 直接输出。重载后的 `operator<<` 输出人的姓名和年龄。

### 总结

流插入运算符是 C++ 中用于向输出流中插入数据的重要工具，通过重载允许自定义类型与标准输出方式无缝集成。正确地使用和重载这些运算符可以极大地增强程序的可读性和灵活性。



## 2.>>(流提取操作符)

在 C++ 中，`>>` 被称为流提取运算符（stream extraction operator），用于从输入流中提取数据。这个运算符可以被重载，使其适用于从各种输入流（如 `std::istream` 对象，包括 `std::cin`、文件输入流 `std::ifstream`、字符串流 `std::istringstream` 等）读取不同类型的数据。

### 原理

流提取运算符通过重载 `operator>>` 函数实现。这种重载允许开发者定义自定义类型如何从输入流中读取数据。例如，当你使用 `std::cin >> x;` 这样的语句时，你实际上是在调用 `std::istream` 类的一个 `operator>>` 成员函数或友元函数，以从 `std::cin` 中提取数据并存储到变量 `x` 中。

### 函数原型

C++ 标准库已经为 `std::istream` 提供了多个针对基本数据类型的 `operator>>` 重载版本。这些函数通常被定义为 `std::istream` 类的成员函数或友元函数。下面是一些常见的流提取运算符的函数原型示例：

```cpp
std::istream& operator>>(std::istream& is, int& n);
std::istream& operator>>(std::istream& is, double& d);
std::istream& operator>>(std::istream& is, std::string& s);
std::istream& operator>>(std::istream& is, char& c);
```

这些函数接受一个引用到 `std::istream` 对象和一个同类型的引用变量，该变量将存储从输入流中读取的数据。函数返回对 `std::istream` 对象的引用，这允许链式调用，即可以连续使用多个 `>>` 运算符。

### 示例：重载自定义类型

如果你有一个自定义类型，如一个 `Person` 类，并希望能够通过 `std::cin` 或其他 `std::istream` 对象直接读取数据，你可以重载 `operator>>` 以实现这一功能：

```cpp
#include <iostream>
#include <string>

class Person {
public:
    std::string name;
    int age;

    // 构造函数可以根据需要定义
};

// 重载 operator>> 为 Person 类
std::istream& operator>>(std::istream& is, Person& p) {
    is >> p.name >> p.age;
    return is;
}

int main() {
    Person john;
    std::cout << "Enter name and age: ";
    std::cin >> john;
    std::cout << "Name: " << john.name << ", Age: " << john.age << std::endl;
    return 0;
}
```

在这个例子中，我们定义了一个 `Person` 类，并重载了 `operator>>` 来允许从 `std::cin` 中直接读取 `Person` 对象的数据。这个重载使得可以通过简单的 `std::cin >> person;` 语法来填充 `Person` 对象的属性。

### 总结

流提取运算符是 C++ 中用于从输入流中读取数据的重要工具。通过重载这些运算符，可以使自定义类型的输入处理与标凈类型一样简单直接。这不仅提高了代码的可读性，还增加了程序的灵活性和模块化程度。

## 3.`<<` 流插入操作符的结合性

此外，再看一个“≪”运算符的右结合性问题。看看如下范例：

```cpp
int i = 3;
std::cout << i-- << i--;// 结果是23?
```

### 操作符的结合性

在 C++ 中，流插入操作符 `<<` 是左结合的，这意味着在没有括号的情况下，表达式按从左到右的顺序组合。所以，表达式 `std::cout << i-- << i--;` 的组合实际上是 `((std::cout << i--) << i--);`。

### 表达式求值顺序

关于您提到的 `std::cout << i-- << i--;` 产生输出 `23` 的分析有一个误解。在 C++ 中，`<<` 操作符的两边表达式的求值顺序是未指定的。这意味着编译器可以选择先评估第一个 `i--`，然后是第二个 `i--`，或者反过来。因此，这种写法的结果是未定义的，不同的编译器可能给出不同的结果，甚至同一编译器在不同的优化级别下也可能不同。

### 示例分析

在表达式 `std::cout << i-- << i--;` 中，因为 `i--` 的求值顺序未定义，两个 `i--` 的执行顺序可能交换，所以可能输出 `23`，也可能输出 `32`，或者在某些环境下可能产生运行时错误。

### 正确的编码实践

如您所述，避免在一个表达式中多次修改同一个变量是一种良好的编程实践，因为这样做往往会导致代码难以理解和预测。更好的做法是将每个操作分解成单独的语句，例如：

```cpp
std::cout << i--;
std::cout << i--;
```

这样做可以清晰地定义每个操作的执行顺序，并避免引入未定义行为。

### 结论

总的来说，您对于避免在一行中多次修改同一个变量的建议是正确的，但需要注意的是 `<<` 操作符是左结合的，而且在涉及到多个可能改变状态的操作时，其求值顺序是未定义的，这可能导致不同编译器之间行为的差异。

(尝试下写两千个这样语句的循环语句来进行输出来查看结果，待完成)

## 4.`>>` 流提取操作符的结合性

 `>>` 流提取运算符（stream extraction operator）的结合性和行为，让我们来详细探讨一下。

### 流提取运算符 `>>`

流提取运算符 `>>` 用于从输入流中读取数据，常见于与 `std::cin` 或其他 `std::istream` 对象一起使用。它与 `<<` 流插入运算符相对，是用于输入的。

### 操作符的结合性

在 C++ 中，`>>` 操作符同样是左结合的。这意味着在连续使用多个 `>>` 操作符进行输入操作时，它们会从左到右地关联和求值。例如：

```cpp
int a, b;
std::cin >> a >> b;
```

这行代码等价于：

```cpp
(std::cin >> a) >> b;
```

首先，`std::cin >> a` 从输入流中提取一个整数并存储到变量 `a` 中，然后返回输入流的引用。接着，这个返回的输入流的引用用于 `>> b` 操作，从流中提取下一个整数存储到变量 `b` 中。

### 表达式求值顺序

对于 `>>` 操作符，每个操作数（即每次输入的目标变量）的求值顺序是从左到右的。这与 `<<` 操作符不同，后者在输出时涉及的每个子表达式的求值顺序是未指定的。在输入操作中，因为输入流是逐个从左到右处理的，所以顺序是明确的。

### 示例

如果您有以下代码：

```cpp
int x, y;
std::cin >> x >> y;
```

用户需要按顺序输入两个整数，首先输入的整数会存储到 `x`，随后输入的整数存储到 `y`。这个顺序是确定和可预测的。

### 结论

总结一下，`>>` 操作符用于从输入流中提取数据，是左结合的，且在处理输入时具有确定的顺序。这样的设计使得在从输入流读取多个变量时代码清晰且行为可预测。不过，就像 `<<` 操作符一样，应避免在一个表达式中对同一个变量进行多次输入，尽管在这种情况下问题不如输出时那么复杂。