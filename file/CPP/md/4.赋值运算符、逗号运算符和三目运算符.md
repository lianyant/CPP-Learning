# 赋值运算符、逗号运算符和三目运算符

​	在C/C++中，赋值运算符、逗号运算符和三目运算符都是非常基础且重要的组成部分，它们在编写代码时经常被用到。

## 1.赋值运算符（=）

​	赋值运算符用于将右侧表达式的值赋给左侧的变量。C/C++支持多种形式的赋值运算符，除了基本的赋值运算符（=）之外，还包括复合赋值运算符（都隶属于赋值运算符），例如+=、-=、*=、/=等。

基本用法是：

```cpp
int a = 5; // 将5赋值给变量a
a += 2; // 等同于a = a + 2，现在a的值是7
```

## 2.逗号运算符

​	逗号运算符用于在同一行内顺序执行多个表达式，并返回最后一个表达式的值。这个运算符通常用于for循环中，但使用时需要注意，因为它可能会导致代码难以理解。

逗号运算符的用法示例：

```cpp
int a = (5, 10); // a的值将是10，因为10是最后一个表达式的值
```

在for循环中的典型用法：

```cpp
for(int i = 0, j = 10; i < j; i++, j--)
{
    // 循环体
}
/**
* 在这个for循环示例中，逗号运算符在初始化和迭代部分被用来顺序执行多个操作，使得可以在单个for语句中初始化和更新多个 * 变量。这是一种常见的技巧，用于控制循环的复杂条件，尤其是在需要同时更新多个变量的循环中。
*/
```

## 3.三目运算符

​	三目运算符也称为条件运算符，它是唯一的一个三元运算符。其格式为 `条件 ? 表达式1 : 表达式2`。如果条件为真（非零），则计算并返回表达式1的值；否则，计算并返回表达式2的值。

三目运算符的用法示例：

```cpp
int a = 10, b = 5;
int max = (a > b) ? a : b; // 如果a大于b，则max的值为a，否则为b
```

​	三目运算符常用于简化if-else语句，使代码更紧凑。然而，过度使用或在复杂的表达式中使用三目运算符可能会使代码难以阅读和理解。

## 4.对以上三种运算符的总结

​	这三种运算符在C/C++中有着各自的用途和特点。赋值运算符用于变量的赋值，逗号运算符用于在单个语句中执行多个表达式，三目运算符提供了一种简洁的方式来根据条件选择两个表达式之一的值。理解它们的工作方式和适用场景对于编写高效、易于维护的代码至关重要。

## 5.赋值表达式、逗号表达式和三目表达式

​	这些表达式(赋值表达式、逗号表达式和三目表达式)不仅反映了运算符的用法，还涉及到了表达式的值、类型和求值顺序。

### 赋值表达式

​	赋值表达式的基本形式是 `lvalue = expression`，其中，`lvalue`（左值）代表了内存中的一个位置，可以是变量、数组元素、指针解引用等，而`expression`可以是任意类型的表达式，其值将被计算并赋给左值。赋值表达式的结果是赋值后的值，并且这个表达式本身也有类型和值，其类型通常是左值的类型，其值是赋给左值的值。

​	在C/C++中，赋值也有副作用，即修改左值所指向的存储位置的内容。因此，赋值表达式不仅仅是计算一个值，还会改变程序的状态。

​	举例：

​	赋值表达式最基本的形式：

```cpp
int a;
a = 10; // 基本赋值表达式
int b;
b = a; // 另一个赋值表达式，将a的值赋给b
```

​	复合赋值表达式结合了运算和赋值的操作：

```cpp
int a = 6;
int b;
b = 5 + a;
b += 3; // 复合赋值表达式，等同于b = b + 3
```

### 赋值表达式效率问题

#### 1.基本数据类型

​	在现代编译器中，`a += 3;` 和 `a = a + 3;` 这两种写法的效率通常是相同的。这是因为编译器非常擅长优化这类简单的算术表达式，特别是在涉及基本数据类型（如 `int`）时。

**语义和编译器优化**

- **语义上的差异**：从语义上讲，`a += 3;` 是一个复合赋值操作，它意味着将 `a` 与 `3` 相加，并将结果存回 `a`。而 `a = a + 3;` 则是一个表达式求值后赋值给 `a` 的操作。尽管这两者的意图稍有不同，但最终的结果是一样的。
- **编译器优化**：现代编译器在编译代码时会进行所谓的“优化”，在这个过程中，编译器会尝试简化或改进代码，以便运行更快或使用更少的资源。对于 `a += 3;` 和 `a = a + 3;`，编译器通常会生成几乎相同的机器指令，尤其是在优化开启时（如使用 `-O2` 或 `-O3` 优化级别的 GCC 或 Clang）。

**实际的汇编输出**

​	如果我们用 GCC 或 Clang 等编译器检查这两条语句的汇编输出，通常会发现它们产生相同的汇编代码。例如，在不涉及复杂表达式的情况下，两种形式都可能简化为相同的加法和存储指令。

**代码清晰度和风格**

尽管在性能上它们是等价的，但在实际编程中，选择使用哪一种形式通常取决于代码风格和清晰度的考虑：

- `a += 3;` 更紧凑，且直接表达了增加的意图，这在进行多个相似操作时可以使代码更加清晰。
- `a = a + 3;` 在某些情况下可能更明确，特别是在复杂的表达式中，当你希望突出表达式的值如何改变时。

**结论**

​	对于简单的整数和基本类型，`a += 3;` 和 `a = a + 3;` 在性能上没有区别，你可以根据个人偏好或团队的编码标准来选择使用哪一种。在代码维护和可读性方面，`+=` 操作符通常被视为更简洁和更具表达性的选择。

#### 2.非基本数据类型

​	当涉及到非基本类型，特别是在C++中自定义类型（如类）的情况下，`a += 3;` 和 `a = a + 3;` 之间的效率可能会有明显区别，这取决于如何为这些操作符实现重载。

**重载操作符的效率**

在C++中，可以为类重载各种操作符，包括 `+=` 和 `+`。这两个操作符的重载通常有不同的实现细节和效率影响：

- **`+=` 操作符**：通常直接在原对象上操作，修改其状态，不需要创建新的对象。这使得 `+=` 通常更高效，因为它避免了额外的对象创建和销毁过程，也不需要额外的返回值复制。
- **`+` 操作符**：通常会生成一个新的临时对象来存储操作结果，然后返回这个对象。这意味着除了执行加法逻辑外，还可能涉及到对象的构造和析构，以及可能的返回值优化（RVO或NRVO）。

**示例：自定义类型的重载**

考虑以下自定义类 `MyClass`，其中重载了 `+=` 和 `+` 操作符：

```cpp
class MyClass {
public:
    MyClass& operator+=(const MyClass& other) {
        // 直接修改当前对象
        // 假设有一些成员变量需要修改
        return *this;
    }

    MyClass operator+(const MyClass& other) const {
        MyClass result = *this; // 创建新对象作为结果
        result += other; // 使用 += 来累加值
        return result; // 返回新对象（可能有RVO）
    }
};

MyClass a, b;
a += b; // 直接在a上修改，无额外对象创建
a = a + b; // 创建临时对象，可能有RVO，但仍有构造和析构开销
```

**性能比较**

在这个例子中，`a += b;` 可能比 `a = a + b;` 更高效，因为后者涉及到创建临时对象并处理返回值。如果 `MyClass` 的构造和析构涉及大量资源管理（如动态内存分配），差异可能更加显著。

**实践建议**

- **简单类型**：对于基本数据类型和小型对象，`+=` 和 `+` 的性能差异可能微不足道，特别是在现代编译器优化的帮助下。
- **复杂或资源密集型类型**：对于大型或资源密集型的自定义类型，推荐使用 `+=` 来避免不必要的复制和资源开销。

​	总之，选择 `+=` 还是 `+`，应基于对操作符重载实现的理解和特定场景的性能需求。在设计自定义类型时，合理地实现这些操作符重载可以显著影响类的使用效率和便利性。

### 逗号表达式

​	逗号表达式允许在同一个表达式中顺序地评估多个表达式，并返回最后一个表达式的值。其基本形式为 `expression1, expression2, ..., expressionN`。逗号表达式的类型和值是最后一个表达式的类型和值。逗号表达式中的每个表达式都会被求值，而且求值顺序是从左到右。

​	逗号表达式常用于循环语句中，特别是在需要多个变量的初始化和更新时。它的一个重要特点是确保了操作的顺序，这在某些复杂的操作中非常重要。

​	举例1：

​	逗号表达式可以用来在一行代码中执行多个操作，并返回最后一个操作的结果：

```cpp
int a = 1, b = 2;
int c = (a++, b++); // a和b都会递增，但c的值为b递增前的值，即2
```

​	在`for`循环中使用逗号表达式进行多变量的初始化和更新：

```cpp
for (int i = 0, j = 10; i < 10; ++i, --j) {
    // 此处可以使用i和j，i从0递增
}

int a = 1, b = 2, c;
c = (a++, b++); // a和b都被递增，但c的值是b递增后的值. 这里，a++ 和 b++ 都会被执行，a 和 b 的值分别递增。逗号表达式的结果是最			     // 后一个表达式的值，即b++的结果，这个结果被赋给了c。
```

​	举例2：

```c
int a;
a = (4,5);// a = 5，因为逗号表达式(运算符)优先级太低（逗号运算符是优先级最低的运算符），所以必须加括号()
a = (3+5, 6+8);// a = 14
a = 3*5,a*4;// 整个表达式的值为60(a的值为15)，因为先计算a = 3*5，再计算a*4，最后的结果是a*4的值。
printf("a的值= %d，整个逗号表达式的值= %d\n",a=3*5,a*4);// 这里逗号仅作为参数分隔符，而不是逗号运算符。a的值为15，整个逗号表达式的(结果)值为60


// printf("a的值= %d，整个逗号表达式的值= %d\n",(a=3*5,a*4);
/*这里，逗号确实作为逗号运算符使用，因为它包含在括号内。逗号运算符会按顺序执行两边的表达式，并返回最后一个表达式的结果。但是，这种写法在C语言中是不正确的，因为 printf 需要两个 %d 对应的两个参数，而上述代码只提供了一个参数。正确的格式应该是：*/

printf("a的值= %d，整个逗号表达式的值= %d\n", (a=3*5), (a=3*5, a*4));// a的值= 15，整个逗号表达式的值= 60
/*第一个参数 (a=3*5) 会计算并赋值 a 为 15，并且这个值会作为第一个 %d 的实际参数。
第二个参数 (a=3*5, a*4) 会先执行 a=3*5，再执行 a*4，最终返回 60 作为第二个 %d 的实际参数。*/

// printf("整个逗号表达式的值= %d\n", a=3*5, a*4); // 错误.不符合 printf 函数期望的参数格式,参数数量与格式不匹配 
/*参数数量与格式不匹配：格式字符串 "整个逗号表达式的值= %d\n" 中只包含一个 %d 格式指定符，这意味着 printf 期望后面跟随一个相应的参数。然而，这里提供了两个参数 (a=3*5 和 a*4)。
未使用的参数：在 printf 中提供多于格式指定符的参数通常不会引发编译错误，但这是一个不良的编程实践，因为多余的参数将被忽略，这可能导致程序逻辑不清晰或误导其他开发者。对应下面这样写就是对的：*/

printf("整个逗号表达式的值= %d\n", (a=3*5, a*4));// 整个逗号表达式的值= 60
```

### 三目表达式

​	三目表达式或条件表达式的形式为 `condition ? expression1 : expression2`。首先，`condition`会被求值，如果条件为真（即非零），则求值`expression1`并返回其值；如果条件为假（即零），则求值`expression2`并返回其值。三目表达式的类型取决于`expression1`和`expression2`的类型。如果这两个表达式的类型不同，则按照C/C++的类型转换规则进行隐式转换，以确定整个表达式的类型。

​	三目表达式提供了一种紧凑的方式来选择两个值之间的一个，可以用来代替简单的if-else结构，使代码更加简洁。然而，滥用三目表达式可能会导致代码难以理解，特别是当嵌套使用时。

​	三目表达式根据条件表达式的真假来选择两个表达式之一的结果。下面是一个例子：

```cpp
int a = 5, b = 10;
int max = (a > b) ? a : b; // 如果a大于b，max为a的值，否则为b的值
```

​	在这个例子中，表达式`(a > b) ? a : b` 检查`a`是否大于`b`。因为`a`不大于`b`，所以表达式的结果是`b`的值，即10，这个值被赋给了`max`变量。

​	这三种表达式各有特点和用途，在编程时选择合适的表达式可以使代码更加清晰、高效。然而，也需要注意避免过度复杂化表达式，以保持代码的可读性和可维护性。